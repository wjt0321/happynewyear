# ğŸ§§ å¾®ä¿¡å°ç¨‹åºæ–°å¹´æŠ½ç­¾åº”ç”¨

ä¸€ä¸ªåŸºäºuni-app + Vue3 + TypeScriptå¼€å‘çš„å¾®ä¿¡å°ç¨‹åºæ–°å¹´æŠ½ç­¾åº”ç”¨ï¼Œåç«¯ä½¿ç”¨Node.js + Express + SQLiteï¼Œæ”¯æŒDockerå®¹å™¨åŒ–éƒ¨ç½²ã€‚

## ğŸ“± åŠŸèƒ½ç‰¹è‰²

- ğŸŠ **æ–°å¹´ä¸»é¢˜ç•Œé¢** - ä¸­å›½çº¢é…è‰²ï¼Œé£˜é›ªçƒŸèŠ±åŠ¨ç”»æ•ˆæœ
- ğŸ² **æ™ºèƒ½æŠ½ç­¾ç³»ç»Ÿ** - 50æ¡ç²¾é€‰æ–°å¹´è¿åŠ¿ï¼Œä¸é‡å¤æŠ½å–
- â° **é˜²åˆ·æœºåˆ¶** - 10ç§’å†·å´æœŸï¼Œé˜²æ­¢æ¶æ„åˆ·å–
- ğŸ“¤ **å¾®ä¿¡åˆ†äº«** - ä¸€é”®åˆ†äº«è¿åŠ¿ç»™å¥½å‹
- ğŸ” **å¾®ä¿¡ç™»å½•** - å®‰å…¨çš„ç”¨æˆ·èº«ä»½è¯†åˆ«
- ğŸ“± **å“åº”å¼è®¾è®¡** - é€‚é…å„ç§å±å¹•å°ºå¯¸
- ğŸ³ **Dockeréƒ¨ç½²** - ä¸€é”®å®¹å™¨åŒ–éƒ¨ç½²

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ
- **uni-app** - è·¨å¹³å°å¼€å‘æ¡†æ¶
- **Vue 3** - ç°ä»£åŒ–å‰ç«¯æ¡†æ¶
- **TypeScript** - ç±»å‹å®‰å…¨
- **Pinia** - çŠ¶æ€ç®¡ç†
- **SCSS** - æ ·å¼é¢„å¤„ç†

### åç«¯æŠ€æœ¯æ ˆ
- **Node.js 18+** - JavaScriptè¿è¡Œæ—¶
- **Express 4.x** - Webæ¡†æ¶
- **SQLite 3** - è½»é‡çº§æ•°æ®åº“
- **better-sqlite3** - é«˜æ€§èƒ½æ•°æ®åº“é©±åŠ¨
- **TypeScript** - ç±»å‹å®‰å…¨

### éƒ¨ç½²æŠ€æœ¯
- **Docker** - å®¹å™¨åŒ–éƒ¨ç½²
- **Cloudflare Tunnel** - HTTPSåŸŸåä»£ç†
- **Docker Compose** - æœåŠ¡ç¼–æ’

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.0.0
- npm >= 8.0.0
- Docker (å¯é€‰ï¼Œç”¨äºå®¹å™¨åŒ–éƒ¨ç½²)

### å®‰è£…ä¾èµ–

```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
npm run install:all

# æˆ–åˆ†åˆ«å®‰è£…
npm install
npm run install:backend
npm run install:frontend
```

### å¼€å‘ç¯å¢ƒè¿è¡Œ

```bash
# å¯åŠ¨å¼€å‘ç¯å¢ƒï¼ˆå‰åç«¯åŒæ—¶å¯åŠ¨ï¼‰
npm run dev

# æˆ–åˆ†åˆ«å¯åŠ¨
npm run dev:backend  # åç«¯æœåŠ¡ http://localhost:3000
npm run dev:frontend # å‰ç«¯æœåŠ¡ http://localhost:8080
```

### ç”Ÿäº§ç¯å¢ƒæ„å»º

```bash
# æ„å»ºæ‰€æœ‰é¡¹ç›®
npm run build

# æˆ–åˆ†åˆ«æ„å»º
npm run build:backend
npm run build:frontend
```

## ğŸ§ª æµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:all

# åˆ†åˆ«è¿è¡Œæµ‹è¯•
npm run test:backend    # åç«¯å•å…ƒæµ‹è¯•
npm run test:frontend   # å‰ç«¯å•å…ƒæµ‹è¯•
npm run test:integration # é›†æˆæµ‹è¯•
npm run test:e2e        # ç«¯åˆ°ç«¯æµ‹è¯•
```

### æµ‹è¯•è¦†ç›–ç‡

- **åç«¯æµ‹è¯•**: 55ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–æ•°æ®åº“ã€APIã€ä¸šåŠ¡é€»è¾‘
- **å‰ç«¯æµ‹è¯•**: 260ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–ç»„ä»¶ã€é¡µé¢ã€å·¥å…·å‡½æ•°
- **é›†æˆæµ‹è¯•**: 6ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ŒéªŒè¯å‰åç«¯åä½œ
- **å±æ€§æµ‹è¯•**: éªŒè¯ç³»ç»Ÿæ­£ç¡®æ€§å±æ€§

## ğŸ³ Dockeréƒ¨ç½²

### éƒ¨ç½²æ–¹å¼é€‰æ‹©

é¡¹ç›®æä¾›ä¸‰ç§Dockeréƒ¨ç½²é…ç½®ï¼š

| éƒ¨ç½²æ–¹å¼ | é…ç½®æ–‡ä»¶ | ç«¯å£ | é€‚ç”¨åœºæ™¯ |
|---------|----------|------|----------|
| å¼€å‘ç¯å¢ƒ | `docker-compose.dev.yml` | 3000 | æœ¬åœ°å¼€å‘è°ƒè¯• |
| ç”Ÿäº§ç¯å¢ƒ | `docker-compose.prod.yml` | 3000 | äº‘æœåŠ¡å™¨éƒ¨ç½² |
| **ğŸ†• NASç¯å¢ƒ** | **`docker-compose.nas.yml`** | **18080** | **NASç³»ç»Ÿéƒ¨ç½²** |

### NASç¯å¢ƒéƒ¨ç½²ï¼ˆæ–°å¢æ¨èï¼‰

ä¸“é—¨ä¸ºNASç¯å¢ƒä¼˜åŒ–çš„éƒ¨ç½²é…ç½®ï¼Œé€‚ç”¨äºç¾¤æ™–ã€å¨è”é€šç­‰NASç³»ç»Ÿï¼š

```bash
# 1. å‡†å¤‡NASç¯å¢ƒé…ç½®
cp .env.nas.example .env.nas
# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®NASè·¯å¾„å’Œç«¯å£

# 2. åˆ›å»ºNASæ•°æ®ç›®å½•
mkdir -p /volume1/docker/wechat-fortune-draw/{data,logs}
chmod 755 /volume1/docker/wechat-fortune-draw

# 3. å¯åŠ¨NASæœåŠ¡
docker-compose -f docker-compose.nas.yml --env-file .env.nas up -d

# 4. éªŒè¯æœåŠ¡çŠ¶æ€
curl http://localhost:18080/api/health
```

**NASé…ç½®ç‰¹ç‚¹ï¼š**
- ğŸ”Œ **é«˜ç«¯å£é…ç½®**ï¼šä½¿ç”¨18080/18082ç«¯å£é¿å…å†²çª
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šSQLite WALæ¨¡å¼ã€æ•°æ®åº“ç¼“å­˜ä¼˜åŒ–
- ğŸ›¡ï¸ **å®‰å…¨å¢å¼º**ï¼šåªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿã€å®‰å…¨é€‰é¡¹é…ç½®
- ğŸ“Š **ç›‘æ§å®Œå–„**ï¼šç‹¬ç«‹å¥åº·æ£€æŸ¥å’Œæ—¥å¿—ç®¡ç†
- ğŸ’¾ **æ•°æ®æŒä¹…åŒ–**ï¼šä¼˜åŒ–çš„NASæ•°æ®å·æŒ‚è½½

### ä½¿ç”¨Docker Composeï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰

```bash
# å¼€å‘ç¯å¢ƒ
docker-compose -f docker-compose.dev.yml up

# ç”Ÿäº§ç¯å¢ƒ
docker-compose -f docker-compose.prod.yml up -d
```

### æ‰‹åŠ¨Dockeræ„å»º

```bash
# æ„å»ºé•œåƒ
docker build -t wechat-fortune-draw ./backend

# è¿è¡Œå®¹å™¨
docker run -d -p 3000:3000 -v $(pwd)/data:/app/data wechat-fortune-draw
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
wechat-fortune-draw/
â”œâ”€â”€ backend/                 # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ database/       # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ routes/         # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ services/       # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ middleware/     # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ types/          # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ tests/              # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ Dockerfile          # Dockeré…ç½®
â”œâ”€â”€ frontend/               # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/          # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ components/     # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/         # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ styles/         # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ tests/              # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ scripts/                # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ tests/                  # ç«¯åˆ°ç«¯æµ‹è¯•
â””â”€â”€ docs/                   # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

åˆ›å»º `backend/.env` æ–‡ä»¶ï¼š

```env
# æœåŠ¡é…ç½®
PORT=3000
NODE_ENV=production

# æ•°æ®åº“é…ç½®
DB_PATH=./data/fortune.db

# å¾®ä¿¡å°ç¨‹åºé…ç½®
WECHAT_APP_ID=your_app_id
WECHAT_APP_SECRET=your_app_secret

# å®‰å…¨é…ç½®
JWT_SECRET=your_jwt_secret
```

### æ•°æ®åº“åˆå§‹åŒ–

ç³»ç»Ÿé¦–æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨ï¼š
- åˆ›å»ºSQLiteæ•°æ®åº“æ–‡ä»¶
- åˆå§‹åŒ–è¡¨ç»“æ„ï¼ˆfortunesã€user_drawsï¼‰
- æ’å…¥50æ¡é¢„è®¾è¿åŠ¿æ•°æ®
- åˆ›å»ºå¿…è¦çš„ç´¢å¼•

## ğŸ“Š APIæ–‡æ¡£

### æŠ½ç­¾æ¥å£

```http
POST /api/fortune
Content-Type: application/json

{
  "openid": "user_openid_here"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "text": "2026å¹´è´¢è¿çˆ†æ£šï¼Œé‡‘é“¶æ»¡å±‹ï¼",
    "isNew": true
  }
}
```

### å¥åº·æ£€æŸ¥

```http
GET /api/health
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "status": "ok",
  "timestamp": "2026-01-06T12:00:00.000Z",
  "database": "connected"
}
```

## ğŸ¨ ç•Œé¢é¢„è§ˆ

### é¦–é¡µ
- æ–°å¹´ä¸»é¢˜èƒŒæ™¯åŠ¨ç”»
- ä¸­å¤®æŠ½ç­¾æŒ‰é’®
- è£…é¥°æ€§å…ƒç´ ï¼ˆç¯ç¬¼ã€é‡‘å¸ã€é¾™ç­‰ï¼‰
- å†·å´å€’è®¡æ—¶æ˜¾ç¤º

### ç»“æœé¡µ
- è¿åŠ¿å¡ç‰‡å±•ç¤º
- é‡‘å…‰é—ªçƒåŠ¨ç”»
- åˆ†äº«å’Œå†æ¬¡æŠ½ç­¾æŒ‰é’®
- åº†ç¥ç²’å­æ•ˆæœ

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **ç”¨æˆ·èº«ä»½éªŒè¯** - å¾®ä¿¡openidè¯†åˆ«
- **é˜²åˆ·æœºåˆ¶** - 10ç§’å†·å´æœŸ
- **æ•°æ®å®Œæ•´æ€§** - å¤–é”®çº¦æŸå’Œå”¯ä¸€æ€§æ£€æŸ¥
- **è¾“å…¥éªŒè¯** - ä¸¥æ ¼çš„å‚æ•°æ ¡éªŒ
- **é”™è¯¯å¤„ç†** - å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- **æ•°æ®åº“ç´¢å¼•** - ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- **è¿æ¥æ± ç®¡ç†** - é«˜æ•ˆçš„æ•°æ®åº“è¿æ¥
- **ç¼“å­˜æœºåˆ¶** - è¿åŠ¿æ•°æ®ç¼“å­˜
- **å“åº”å¼è®¾è®¡** - é€‚é…å„ç§è®¾å¤‡
- **ä»£ç åˆ†å‰²** - æŒ‰éœ€åŠ è½½

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
   netstat -ano | findstr :3000
   # ç»ˆæ­¢è¿›ç¨‹
   taskkill /PID <è¿›ç¨‹ID> /F
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
   - ç¡®è®¤æ•°æ®ç›®å½•å­˜åœ¨
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

3. **å¾®ä¿¡ç™»å½•å¤±è´¥**
   - æ£€æŸ¥AppIDå’ŒAppSecreté…ç½®
   - ç¡®è®¤å°ç¨‹åºåŸŸåé…ç½®
   - éªŒè¯ç½‘ç»œè¿æ¥

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-06)
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸŠ å®Œæ•´çš„æ–°å¹´æŠ½ç­¾åŠŸèƒ½
- ğŸ“± å¾®ä¿¡å°ç¨‹åºæ”¯æŒ
- ğŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²
- ğŸ§ª å®Œæ•´çš„æµ‹è¯•è¦†ç›–

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ‘¥ ä½œè€…

- **Fortune Draw Team** - *åˆå§‹å¼€å‘* - [GitHub](https://github.com/your-username)

## ğŸ™ è‡´è°¢

- æ„Ÿè°¢uni-appå›¢é˜Ÿæä¾›ä¼˜ç§€çš„è·¨å¹³å°å¼€å‘æ¡†æ¶
- æ„Ÿè°¢Vue.jsç¤¾åŒºçš„æŠ€æœ¯æ”¯æŒ
- æ„Ÿè°¢æ‰€æœ‰æµ‹è¯•ç”¨æˆ·çš„åé¦ˆ

---

**ğŸŠ ç¥æ‚¨æ–°å¹´å¿«ä¹ï¼Œå¥½è¿è¿è¿ï¼ğŸŠ**