# ğŸ“– å¾®ä¿¡å°ç¨‹åºæ–°å¹´æŠ½ç­¾åº”ç”¨ - ä½¿ç”¨æŒ‡å—

## ğŸ¯ å¿«é€Ÿä¸Šæ‰‹

### å¼€å‘ç¯å¢ƒæ­å»º

#### 1. ç¯å¢ƒå‡†å¤‡
```bash
# æ£€æŸ¥Node.jsç‰ˆæœ¬ï¼ˆéœ€è¦18+ï¼‰
node --version

# æ£€æŸ¥npmç‰ˆæœ¬ï¼ˆéœ€è¦8+ï¼‰
npm --version

# å…‹éš†é¡¹ç›®
git clone <your-repository-url>
cd wechat-fortune-draw
```

#### 2. å®‰è£…ä¾èµ–
```bash
# ä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ–
npm run install:all

# è¿™ä¸ªå‘½ä»¤ä¼šä¾æ¬¡æ‰§è¡Œï¼š
# npm install          # æ ¹ç›®å½•ä¾èµ–
# npm run install:backend   # åç«¯ä¾èµ–
# npm run install:frontend  # å‰ç«¯ä¾èµ–
```

#### 3. å¯åŠ¨å¼€å‘æœåŠ¡
```bash
# åŒæ—¶å¯åŠ¨å‰åç«¯å¼€å‘æœåŠ¡
npm run dev

# æˆ–è€…åˆ†åˆ«å¯åŠ¨
npm run dev:backend   # åç«¯: http://localhost:3000
npm run dev:frontend  # å‰ç«¯: http://localhost:8080
```

### é¡¹ç›®ç»“æ„è¯´æ˜

```
wechat-fortune-draw/
â”œâ”€â”€ ğŸ“ backend/              # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ database/     # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseConnection.ts    # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseInitializer.ts   # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”‚   â””â”€â”€ repositories/            # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ routes/       # APIè·¯ç”±
â”‚   â”‚   â”œâ”€â”€ ğŸ“ services/     # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ ğŸ“ middleware/   # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ ğŸ“ types/        # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ ğŸ“ tests/            # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ ğŸ“„ Dockerfile        # Dockeré…ç½®
â”œâ”€â”€ ğŸ“ frontend/             # å‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ ğŸ“ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ pages/        # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ index/       # é¦–é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ result/      # ç»“æœé¡µ
â”‚   â”‚   â”œâ”€â”€ ğŸ“ components/   # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ AnimatedBackground.vue   # åŠ¨ç”»èƒŒæ™¯
â”‚   â”‚   â”‚   â”œâ”€â”€ FortuneButton.vue        # æŠ½ç­¾æŒ‰é’®
â”‚   â”‚   â”‚   â””â”€â”€ CountdownTimer.vue       # å€’è®¡æ—¶ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“ stores/       # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ğŸ“ utils/        # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ ğŸ“ styles/       # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ ğŸ“ tests/            # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ ğŸ“ scripts/             # éƒ¨ç½²å’Œå·¥å…·è„šæœ¬
â”œâ”€â”€ ğŸ“ tests/               # ç«¯åˆ°ç«¯æµ‹è¯•
â””â”€â”€ ğŸ“ docs/                # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ å¼€å‘æŒ‡å—

### åç«¯å¼€å‘

#### 1. æ•°æ®åº“æ“ä½œ
```typescript
// è·å–æ•°æ®åº“ç®¡ç†å™¨å®ä¾‹
import { DatabaseManager } from './database';

const dbManager = DatabaseManager.getInstance();

// è·å–è¿åŠ¿æ•°æ®
const fortune = await dbManager.getFortuneById(1);

// è®°å½•ç”¨æˆ·æŠ½ç­¾
await dbManager.recordUserDraw('openid123', 1);
```

#### 2. æ·»åŠ æ–°çš„APIæ¥å£
```typescript
// src/routes/index.ts
import { Router } from 'express';

const router = Router();

router.post('/api/new-endpoint', async (req, res) => {
  try {
    // ä¸šåŠ¡é€»è¾‘å¤„ç†
    const result = await someService.process(req.body);
    
    res.json({
      success: true,
      data: result
    });
  } catch (error) {
    res.status(500).json({
      success: false,
      error: error.message
    });
  }
});
```

#### 3. æ•°æ®åº“è¿ç§»
```typescript
// æ·»åŠ æ–°è¡¨æˆ–ä¿®æ”¹è¡¨ç»“æ„
// src/database/DatabaseInitializer.ts

private createTables(): void {
  // æ–°å¢è¡¨çš„SQLè¯­å¥
  const createNewTableSQL = `
    CREATE TABLE IF NOT EXISTS new_table (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      name TEXT NOT NULL,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP
    )
  `;
  
  this.db.exec(createNewTableSQL);
}
```

### å‰ç«¯å¼€å‘

#### 1. åˆ›å»ºæ–°é¡µé¢
```vue
<!-- src/pages/new-page/new-page.vue -->
<template>
  <view class="new-page">
    <text class="title">æ–°é¡µé¢</text>
  </view>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';

const title = ref('æ–°é¡µé¢æ ‡é¢˜');

onMounted(() => {
  console.log('é¡µé¢å·²æŒ‚è½½');
});
</script>

<style lang="scss" scoped>
.new-page {
  padding: 40rpx;
  
  .title {
    font-size: 36rpx;
    font-weight: bold;
  }
}
</style>
```

#### 2. çŠ¶æ€ç®¡ç†
```typescript
// src/stores/new-store.ts
import { defineStore } from 'pinia';

export const useNewStore = defineStore('new', {
  state: () => ({
    data: null as any,
    loading: false,
    error: null as string | null
  }),
  
  actions: {
    async fetchData() {
      this.loading = true;
      try {
        const response = await api.getData();
        this.data = response.data;
      } catch (error) {
        this.error = error.message;
      } finally {
        this.loading = false;
      }
    }
  }
});
```

#### 3. æ·»åŠ æ–°ç»„ä»¶
```vue
<!-- src/components/NewComponent.vue -->
<template>
  <view class="new-component">
    <slot></slot>
  </view>
</template>

<script setup lang="ts">
interface Props {
  title?: string;
  visible?: boolean;
}

const props = withDefaults(defineProps<Props>(), {
  title: 'é»˜è®¤æ ‡é¢˜',
  visible: true
});

const emit = defineEmits<{
  click: [event: Event];
}>();
</script>
```

## ğŸ§ª æµ‹è¯•æŒ‡å—

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:all

# åˆ†åˆ«è¿è¡Œä¸åŒç±»å‹çš„æµ‹è¯•
npm run test:backend      # åç«¯å•å…ƒæµ‹è¯•
npm run test:frontend     # å‰ç«¯å•å…ƒæµ‹è¯•
npm run test:integration  # é›†æˆæµ‹è¯•
npm run test:e2e         # ç«¯åˆ°ç«¯æµ‹è¯•

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
cd backend && npm test -- database.test.ts
cd frontend && npm test -- FortuneButton.test.ts
```

### ç¼–å†™æµ‹è¯•

#### 1. åç«¯å•å…ƒæµ‹è¯•
```typescript
// backend/src/services/__tests__/newService.test.ts
import { NewService } from '../newService';

describe('NewService', () => {
  let service: NewService;
  
  beforeEach(() => {
    service = new NewService();
  });
  
  test('åº”è¯¥æ­£ç¡®å¤„ç†æ•°æ®', async () => {
    const result = await service.processData('test');
    expect(result).toBeDefined();
    expect(result.success).toBe(true);
  });
});
```

#### 2. å‰ç«¯ç»„ä»¶æµ‹è¯•
```typescript
// frontend/tests/components/NewComponent.test.ts
import { mount } from '@vue/test-utils';
import NewComponent from '@/components/NewComponent.vue';

describe('NewComponent', () => {
  test('åº”è¯¥æ­£ç¡®æ¸²æŸ“', () => {
    const wrapper = mount(NewComponent, {
      props: {
        title: 'æµ‹è¯•æ ‡é¢˜'
      }
    });
    
    expect(wrapper.text()).toContain('æµ‹è¯•æ ‡é¢˜');
  });
});
```

#### 3. å±æ€§æµ‹è¯•ï¼ˆProperty-Based Testingï¼‰
```typescript
// éªŒè¯ç³»ç»Ÿå±æ€§çš„æµ‹è¯•
test('å±æ€§æµ‹è¯•: æŠ½ç­¾ç»“æœå”¯ä¸€æ€§', async () => {
  const openid = 'test_user';
  const results = new Set();
  
  // è¿›è¡Œå¤šæ¬¡æŠ½ç­¾æµ‹è¯•
  for (let i = 0; i < 100; i++) {
    const result = await fortuneService.drawFortune(openid);
    if (result.success) {
      results.add(result.data.id);
    }
  }
  
  // éªŒè¯ç»“æœçš„å”¯ä¸€æ€§
  expect(results.size).toBeGreaterThan(1);
});
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### æœ¬åœ°éƒ¨ç½²

#### 1. æ„å»ºé¡¹ç›®
```bash
# æ„å»ºæ‰€æœ‰é¡¹ç›®
npm run build

# åˆ†åˆ«æ„å»º
npm run build:backend   # æ„å»ºåç«¯
npm run build:frontend  # æ„å»ºå‰ç«¯
```

#### 2. ç”Ÿäº§ç¯å¢ƒè¿è¡Œ
```bash
# å¯åŠ¨åç«¯æœåŠ¡
cd backend && npm start

# å‰ç«¯å·²æ„å»ºä¸ºé™æ€æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ä»»ä½•é™æ€æœåŠ¡å™¨æ‰˜ç®¡
# ä¾‹å¦‚ä½¿ç”¨nginxæˆ–è€…ç›´æ¥ç”¨Node.js serve
```

### Dockeréƒ¨ç½²

#### 1. ä½¿ç”¨Docker Composeï¼ˆæ¨èï¼‰
```bash
# å¼€å‘ç¯å¢ƒ
docker-compose -f docker-compose.dev.yml up

# ç”Ÿäº§ç¯å¢ƒ
docker-compose -f docker-compose.prod.yml up -d
```

#### 2. æ‰‹åŠ¨Dockeréƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t wechat-fortune-draw ./backend

# è¿è¡Œå®¹å™¨
docker run -d \
  --name fortune-app \
  -p 3000:3000 \
  -v $(pwd)/data:/app/data \
  -e NODE_ENV=production \
  wechat-fortune-draw
```

### äº‘æœåŠ¡å™¨éƒ¨ç½²

#### 1. æœåŠ¡å™¨å‡†å¤‡
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# å®‰è£…Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose
```

#### 2. éƒ¨ç½²åº”ç”¨
```bash
# å…‹éš†ä»£ç 
git clone <your-repo-url>
cd wechat-fortune-draw

# é…ç½®ç¯å¢ƒå˜é‡
cp backend/.env.example backend/.env
# ç¼–è¾‘ backend/.env æ–‡ä»¶ï¼Œå¡«å…¥æ­£ç¡®çš„é…ç½®

# å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

#### 3. é…ç½®åå‘ä»£ç†ï¼ˆNginxï¼‰
```nginx
# /etc/nginx/sites-available/fortune-app
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®

#### åç«¯ç¯å¢ƒå˜é‡ (backend/.env)
```env
# æœåŠ¡é…ç½®
PORT=3000
NODE_ENV=production

# æ•°æ®åº“é…ç½®
DB_PATH=./data/fortune.db

# å¾®ä¿¡å°ç¨‹åºé…ç½®
WECHAT_APP_ID=your_wechat_app_id
WECHAT_APP_SECRET=your_wechat_app_secret

# å®‰å…¨é…ç½®
JWT_SECRET=your_jwt_secret_key
CORS_ORIGIN=https://your-domain.com

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
LOG_FILE=./logs/app.log
```

#### å‰ç«¯é…ç½® (frontend/.env.production)
```env
# APIé…ç½®
VUE_APP_API_BASE_URL=https://your-api-domain.com
VUE_APP_WECHAT_APP_ID=your_wechat_app_id

# ç¯å¢ƒæ ‡è¯†
NODE_ENV=production
```

### å¾®ä¿¡å°ç¨‹åºé…ç½®

#### 1. å¼€å‘è€…å·¥å…·é…ç½®
```json
// project.config.json
{
  "appid": "your_wechat_app_id",
  "projectname": "wechat-fortune-draw",
  "setting": {
    "urlCheck": false,
    "es6": true,
    "enhance": true,
    "postcss": true,
    "minified": true
  },
  "compileType": "miniprogram"
}
```

#### 2. æœåŠ¡å™¨åŸŸåé…ç½®
åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°é…ç½®ä»¥ä¸‹åŸŸåï¼š
- **requeståˆæ³•åŸŸå**: `https://your-api-domain.com`
- **socketåˆæ³•åŸŸå**: æ— éœ€é…ç½®
- **uploadFileåˆæ³•åŸŸå**: æ— éœ€é…ç½®
- **downloadFileåˆæ³•åŸŸå**: æ— éœ€é…ç½®

## ğŸ› å¸¸è§é—®é¢˜è§£å†³

### å¼€å‘ç¯å¢ƒé—®é¢˜

#### 1. ç«¯å£è¢«å ç”¨
```bash
# Windows
netstat -ano | findstr :3000
taskkill /PID <è¿›ç¨‹ID> /F

# Linux/Mac
lsof -ti:3000 | xargs kill -9
```

#### 2. ä¾èµ–å®‰è£…å¤±è´¥
```bash
# æ¸…ç†ç¼“å­˜
npm cache clean --force

# åˆ é™¤node_modulesé‡æ–°å®‰è£…
rm -rf node_modules package-lock.json
npm install
```

#### 3. æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -la backend/data/

# é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
rm backend/data/fortune.db
npm run dev:backend  # ä¼šè‡ªåŠ¨é‡æ–°åˆ›å»º
```

### ç”Ÿäº§ç¯å¢ƒé—®é¢˜

#### 1. æœåŠ¡å¯åŠ¨å¤±è´¥
```bash
# æŸ¥çœ‹Dockerå®¹å™¨æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨
htop
df -h
```

#### 2. æ•°æ®åº“æ€§èƒ½é—®é¢˜
```sql
-- æ£€æŸ¥æ•°æ®åº“å¤§å°
SELECT 
  name,
  COUNT(*) as count 
FROM sqlite_master 
WHERE type='table' 
GROUP BY name;

-- é‡å»ºç´¢å¼•
REINDEX;

-- æ¸…ç†æ•°æ®åº“
VACUUM;
```

#### 3. å†…å­˜ä¸è¶³
```bash
# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æ·»åŠ äº¤æ¢ç©ºé—´
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
```

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—ç®¡ç†
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
docker-compose logs -f app

# æŸ¥çœ‹Nginxæ—¥å¿—
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# æ—¥å¿—è½®è½¬é…ç½®
# /etc/logrotate.d/fortune-app
/path/to/logs/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 644 www-data www-data
}
```

### æ€§èƒ½ç›‘æ§
```bash
# å®‰è£…ç›‘æ§å·¥å…·
npm install -g pm2

# ä½¿ç”¨PM2ç®¡ç†è¿›ç¨‹
pm2 start backend/dist/index.js --name fortune-app
pm2 monit

# è®¾ç½®è‡ªåŠ¨é‡å¯
pm2 startup
pm2 save
```

### æ•°æ®å¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
#!/bin/bash
# backup.sh
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/path/to/backups"
DB_PATH="/path/to/data/fortune.db"

# åˆ›å»ºå¤‡ä»½
cp $DB_PATH $BACKUP_DIR/fortune_backup_$DATE.db

# ä¿ç•™æœ€è¿‘30å¤©çš„å¤‡ä»½
find $BACKUP_DIR -name "fortune_backup_*.db" -mtime +30 -delete

# è®¾ç½®å®šæ—¶ä»»åŠ¡
# crontab -e
# 0 2 * * * /path/to/backup.sh
```

---

**ğŸŠ ç°åœ¨æ‚¨å·²ç»æŒæ¡äº†å®Œæ•´çš„å¼€å‘å’Œéƒ¨ç½²æµç¨‹ï¼Œå¯ä»¥å¼€å§‹æ‚¨çš„æ–°å¹´æŠ½ç­¾åº”ç”¨ä¹‹æ—…äº†ï¼ğŸŠ**